extends ./layout.jade

block title
    title Accessibility report for #{repo}

block content
    h1!= repo
        each branch in branches
            img(src="/#{repo}.svg?branch=#{branch}" id="#{branch}" class="bdge")
    div.dropdown
        button(class="btn btn-default btn-sm dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true")
            | Branches 
            span.caret
        ul(class="dropdown-menu" aria-labelledby="dropdownMenu1")
            each branch in branches
                li(class="branch-selector" id="#{branch}")
                    a(href="#") #{branch}
        |  showing: 
        span.current_branch
    table.table
        thead
            tr
                th commit
                th errors
                th warnings
                th notices
                th total
        tbody
            each result in results
                tr(class="#{result.branch}")
                    td #[a(href="/#{repo}/#{result.commit}") #{result.commitMessage}] #[a(href="https://github.com/#{repo}/commit/#{result.commit}") #[code #{result.shortCommit}]] 
                    td #{result.error}
                    td #{result.warning}
                    td #{result.notice}
                    td #{result.total}

block script
    script.
        $(document).ready(function (){
            $("tbody>tr").hide();
            $("img.bdge").hide();
            var branches = "#{branches}".split(",");
            console.log(branches);
            if ($.inArray("#{default_branch}", branches) > -1) {
                $("tr.#{default_branch}").show();
                $("img##{default_branch}").show();
                $("span.current_branch").text("#{default_branch}");
            } else {
                $("tr.#{branches[0]}").show();
                $("img##{branches[0]}").show();
                $("span.current_branch").text("#{branches[0]}");
            }
        });
        $(".branch-selector").click(function(){
            $("tbody>tr").hide();
            $("img.bdge").hide();
            $("tr."+$(this).attr("id")).show();
            $("img#"+$(this).attr("id")).show();
            $("span.current_branch").text($(this).attr("id"));
        });